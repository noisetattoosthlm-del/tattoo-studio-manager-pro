        async function saveData() {
            const saveBtn = document.getElementById('save-btn');
            const originalText = saveBtn.innerText;
            
            const name = document.getElementById('c_name').value;
            const time = document.getElementById('app_time').value;
            if(!name || !time) { alert("Ime i datum su obavezni!"); return; }

            saveBtn.disabled = true; 
            saveBtn.innerText = "ČUVANJE...";
            
            try {
                const cena = parseFloat(document.getElementById('total_price').value) || 0;
                const procenat = parseFloat(document.getElementById('artist_percent').value) || 50;
                const valuta = document.getElementById('currency_choice').value;
                const depozit = parseFloat(document.getElementById('deposit_amt').value) || 0;
                
                const payload = {
                    client_name: name, 
                    client_phone: document.getElementById('c_phone').value || "",
                    client_email: document.getElementById('c_email').value || "",
                    client_instagram: document.getElementById('c_insta').value || "",
                    appointment_time: time, 
                    total_price: cena, 
                    currency: valuta,
                    deposit: depozit,
                    artist_percentage: procenat, 
                    studio_share: cena * ((100 - procenat) / 100),
                    payment_type: document.getElementById('payment_type').value
                };

                if (editingId) {
                    const { error } = await supabaseClient.from('appointments').update(payload).eq('id', editingId);
                    if(error) throw error;
                } else {
                    const { data: { user } } = await supabaseClient.auth.getUser();
                    // DODATO: Povlačimo owner_id iz profila trenutnog korisnika
                    const { error } = await supabaseClient.from('appointments').insert([{ 
                        ...payload, 
                        artist_id: user.id, 
                        owner_id: userProfile.owner_id || user.id, // Osigurava da owner_id nije null
                        studio_id: userProfile.studio_id, 
                        status: 'zakazano', 
                        payout_status: 'nema' 
                    }]);
                    if(error) throw error;
                }
                zatvoriModal(); 
                await osveziPodatke();
            } catch (err) { 
                alert("Greška: " + err.message); 
            } finally { 
                saveBtn.disabled = false; 
                saveBtn.innerText = originalText; 
            }
        }
